# Prod: Custom "warming up" page for scale-from-zero
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: health-service-ingress
  annotations:
    nginx.ingress.kubernetes.io/server-snippet: |
      error_page 502 503 @warming;
      location @warming {
        default_type text/html;
        return 503 '<!DOCTYPE html>
        <html>
        <head>
          <title>Starting up...</title>
          <style>
            * { box-sizing: border-box; margin: 0; padding: 0; }
            body {
              font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
              min-height: 100vh;
              display: flex;
              align-items: center;
              justify-content: center;
              background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
              color: #fff;
            }
            .container {
              text-align: center;
              padding: 40px;
              animation: fadeIn 0.5s ease;
            }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
            .coffee { width: 120px; height: 120px; margin: 0 auto 30px; }
            .cup { fill: none; stroke: #e94560; stroke-width: 3; stroke-linecap: round; }
            .steam { stroke: #fff; stroke-width: 2; fill: none; opacity: 0.7; }
            .steam path { animation: steam 2s ease-in-out infinite; }
            .steam path:nth-child(2) { animation-delay: 0.3s; }
            .steam path:nth-child(3) { animation-delay: 0.6s; }
            @keyframes steam { 0%, 100% { transform: translateY(0) scaleX(1); opacity: 0.7; } 50% { transform: translateY(-8px) scaleX(1.2); opacity: 0.3; } }
            h1 { font-size: 2rem; font-weight: 600; margin-bottom: 12px; color: #e94560; }
            .subtitle { font-size: 1.1rem; color: rgba(255,255,255,0.8); margin-bottom: 24px; }
            .dots { display: inline-flex; gap: 4px; }
            .dots span { width: 8px; height: 8px; background: #e94560; border-radius: 50%; animation: bounce 1.4s ease-in-out infinite; }
            .dots span:nth-child(2) { animation-delay: 0.2s; }
            .dots span:nth-child(3) { animation-delay: 0.4s; }
            @keyframes bounce { 0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }
            .status { margin-top: 20px; font-size: 0.8rem; color: rgba(255,255,255,0.4); }
          </style>
        </head>
        <body>
          <div class="container">
            <svg class="coffee" viewBox="0 0 100 100">
              <g class="steam">
                <path d="M35 40 Q35 30 40 25 Q45 20 40 10"/>
                <path d="M50 40 Q50 30 55 25 Q60 20 55 10"/>
                <path d="M65 40 Q65 30 70 25 Q75 20 70 10"/>
              </g>
              <path class="cup" d="M25 45 L30 85 Q30 90 35 90 L65 90 Q70 90 70 85 L75 45"/>
              <path class="cup" d="M75 50 Q90 50 90 65 Q90 75 75 75"/>
            </svg>
            <h1>Brewing your request</h1>
            <p class="subtitle">Service is waking up. Please wait a moment.</p>
            <div class="dots"><span></span><span></span><span></span></div>
            <p class="status">Auto-retrying every 2 seconds...</p>
          </div>
          <script>
            setInterval(() => {
              fetch(location.href)
                .then(r => { if (r.status < 500) location.reload(); })
                .catch(() => {});
            }, 2000);
          </script>
        </body>
        </html>';
      }
